import{aK as de,bk as te,a2 as K,aq as ne,bl as ae,ay as se,a3 as z,am as he,a7 as D,aI as re,bm as pe,bn as oe,bo as ie,ax as ye,bp as fe,a0 as me,q as M,A as Q,bq as we,br as ge,a$ as be,bs as ve,b as Se,bt as Ie,bu as Ee,bv as ke,V as Oe,Z as Pe,av as Re,K as Ce,bw as Le,bx as Ae,C as Ue,J as _e,by as Ne,S as Te,bz as Ve,bA as je,D as xe}from"./Settings-Bqkr9m9-.js";const i=e=>de("pwm",e),ft=i("changeMasterPasswordUsingRecoveryPassword"),mt=i("verifyRecoveryCode"),wt=i("changeMasterPassword"),gt=i("changeRecoveryPassword"),bt=i("getWebsiteLogins"),De=i("checkUserExistsAndAuthenticated"),$e=i("unlock"),Me=i("verifyPrimaryPassword"),Fe=i("lock"),vt=i("deleteAccount"),Je=i("isUnlocked"),Be=i("documentList"),Ge=i("checkPasswordStrength"),Ke=i("createNewLogin"),ze=i("createNewCard"),He=i("createNewSecureNote"),St=i("determineActionFromAccountState"),We=i("webGeneratePassword"),qe=i("updateLogin"),Ze=i("updateCard"),Qe=i("updateSecureNote"),It=i("createNewUser"),Et=i("generateRecoveryKey"),Xe=i("generateRecoveryKeyPdf"),kt=i("getDocumentationForTOTPSite"),Ot=i("generateTotpCode");let H;const $=e=>H=e,W=Symbol();function J(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var T,F;function Pt(){const e=te(!0),t=e.run(()=>K({}));let n=[],a=[];const s=ne({install(r){$(s),s._a=r,r.provide(W,s),r.config.globalProperties.$pinia=s,a.forEach(u=>n.push(u)),a=[]},use(r){return this._a?n.push(r):a.push(r),this},_p:n,_a:null,_e:e,_s:new Map,state:t});return s}(F=T||(T={})).direct="direct",F.patchObject="patch object",F.patchFunction="patch function";const ce=()=>{};function X(e,t,n,a=ce){e.push(t);const s=()=>{const r=e.indexOf(t);r>-1&&(e.splice(r,1),a())};return!n&&oe()&&ie(s),s}function L(e,...t){e.slice().forEach(n=>{n(...t)})}const Ye=e=>e();function B(e,t){e instanceof Map&&t instanceof Map&&t.forEach((n,a)=>e.set(a,n)),e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const n in t){if(!t.hasOwnProperty(n))continue;const a=t[n],s=e[n];J(s)&&J(a)&&e.hasOwnProperty(n)&&!D(a)&&!re(a)?e[n]=B(s,a):e[n]=a}return e}const et=Symbol(),{assign:C}=Object;function Y(e,t,n={},a,s,r){let u;const p=C({actions:{}},n),P={deep:!0};let w,m,b,g=[],E=[];const y=a.state.value[e];let k;function f(l){let c;w=m=!1,typeof l=="function"?(l(a.state.value[e]),c={type:T.patchFunction,storeId:e,events:b}):(B(a.state.value[e],l),c={type:T.patchObject,payload:l,storeId:e,events:b});const O=k=Symbol();ye().then(()=>{k===O&&(w=!0)}),m=!0,L(g,c,a.state.value[e])}r||y||(a.state.value[e]={}),K({});const I=r?function(){const{state:l}=n,c=l?l():{};this.$patch(O=>{C(O,c)})}:ce;function R(l,c){return function(){$(a);const O=Array.from(arguments),U=[],_=[];let N;L(E,{args:O,name:l,store:h,after:function(S){U.push(S)},onError:function(S){_.push(S)}});try{N=c.apply(this&&this.$id===e?this:h,O)}catch(S){throw L(_,S),S}return N instanceof Promise?N.then(S=>(L(U,S),S)).catch(S=>(L(_,S),Promise.reject(S))):(L(U,N),N)}}const o={_p:a,$id:e,$onAction:X.bind(null,E),$patch:f,$reset:I,$subscribe(l,c={}){const O=X(g,l,c.detached,()=>U()),U=u.run(()=>z(()=>a.state.value[e],_=>{(c.flush==="sync"?m:w)&&l({storeId:e,type:T.direct,events:b},_)},C({},P,c)));return O},$dispose:function(){u.stop(),g=[],E=[],a._s.delete(e)}},h=he(o);a._s.set(e,h);const v=(a._a&&a._a.runWithContext||Ye)(()=>a._e.run(()=>(u=te()).run(t)));for(const l in v){const c=v[l];if(D(c)&&(!D(Z=c)||!Z.effect)||re(c))r||(!y||J(A=c)&&A.hasOwnProperty(et)||(D(c)?c.value=y[l]:B(c,y[l])),a.state.value[e][l]=c);else if(typeof c=="function"){const O=R(l,c);v[l]=O,p.actions[l]=c}}var A,Z;return C(h,v),C(pe(h),v),Object.defineProperty(h,"$state",{get:()=>a.state.value[e],set:l=>{f(c=>{C(c,l)})}}),a._p.forEach(l=>{C(h,u.run(()=>l({store:h,app:a._a,pinia:a,options:p})))}),y&&r&&n.hydrate&&n.hydrate(h.$state,y),w=!0,m=!0,h}function le(e,t,n){let a,s;const r=typeof t=="function";function u(p,P){const w=ae();return(p=p||(w?se(W,null):null))&&$(p),(p=H)._s.has(a)||(r?Y(a,t,s,p):function(m,b,g,E){const{state:y,actions:k,getters:f}=b,I=g.state.value[m];let R;R=Y(m,function(){I||(g.state.value[m]=y?y():{});const o=fe(g.state.value[m]);return C(o,k,Object.keys(f||{}).reduce((h,v)=>(h[v]=ne(me(()=>{$(g);const A=g._s.get(m);return f[v].call(A,A)})),h),{}))},b,g,0,!0)}(a,s,p)),p._s.get(a)}return typeof e=="string"?(a=e,s=r?n:t):(s=e,a=e.id),u.$id=a,u}const tt=le("pwm",{state:()=>({hasPwm:void 0,isDeviceVerified:void 0,isVaultUnlocked:!1,syncInterval:void 0,documents:void 0,recoveryKey:"",criticalErrorReason:void 0,isApiReachable:void 0}),actions:{generatePassword:async({length:e=14,mustContainUppercase:t=!0,mustContainLowercase:n=!0,mustContainNumber:a=!0,mustContainSymbol:s=!0,mustExcludeSymbols:r=[]})=>We({length:e,mustContainUppercase:t,mustContainLowercase:n,mustContainNumber:a,mustContainSymbol:s,mustExcludeSymbols:r}),async addSecureNoteEntry(e){return He(e).then(t=>(this.sync(),t))},async updateSecureNoteEntry(e){return await Qe(e).then(()=>(this.sync(),e.uuid))},async addCardEntry(e){return ze(e).then(t=>(this.sync(),t))},async updateCardEntry(e){return await Ze(e).then(()=>(this.sync(),e.uuid))},async addEntry(e){return Ke(e).then(t=>(this.sync(),t))},async updateEntry(e){return await qe(e).then(()=>(this.sync(),e.uuid))},async checkAccountStatus(){return De().then(e=>{const t=(e==null?void 0:e.exists)??!1,n=(e==null?void 0:e.authenticated)??!1;return this.hasPwm=t,this.isDeviceVerified=n,this.isApiReachable||this.isVaultUnlocked||(this.isApiReachable=!0),{exists:t,authenticated:n}}).catch(e=>{throw M(e,"error.api.network")&&(this.isApiReachable=!1),e})},async checkVaultLockStatus(){return Je().then(e=>{this.isVaultUnlocked=e,e===!0&&this.sync()}).catch(e=>{throw this.isVaultUnlocked=!1,e})},async unlockVault(e){return $e({password:e}).then(t=>{this.isVaultUnlocked=t,t===!0&&this.sync(),Q("checkVaultLockStatus")})},async lockVault(){return this.isVaultUnlocked=!1,window.clearInterval(this.syncInterval),this.syncInterval=void 0,Fe().then(()=>{Q("checkVaultLockStatus")})},async getDocuments(){return this.documents=await Be(),this.documents??[]},sync(){clearInterval(this.syncInterval),this.syncInterval=void 0;const e=()=>(Ie().then(()=>(this.isApiReachable=!0,this.getDocuments())).catch(t=>{if(M(t,"error.api.network")&&(this.isApiReachable=!1),!M(t,"errors.locked"))throw t}),e);this.syncInterval=window.setInterval(e(),3e4)},clearOnboardingData(){this.tempPrimaryPassword="",this.recoveryKey=""},clearAll(){this.$reset()},getEntryPassword:async e=>we([e]).then(t=>t.l),getSecureNoteBody:async e=>ge([e]).then(t=>t.s),getCardBody:async e=>be([e]).then(t=>({securityCode:t.sc,cardNumber:t.n})),async deleteEntry(e){this.documents&&(this.documents=this.documents.filter(t=>t.uuid!==e)),ve([e]).then(()=>this.sync())},checkPasswordStrength:async e=>Ge({password:e}),generateRecoveryKeyPdf:async(e,t)=>Xe({recoveryKey:e,localizedStrings:t}),async getDocumentWithSecrets(e){const t=(await this.getDocuments()).find(({uuid:s})=>s===e);if(!t)throw new Error("Document not found");const n=await this.getEntryPassword(e),a=await Se([e]);if(t.type==="login")return{...t,password:n,totp:a.code};throw new Error(`Document type not supported: ${t.type}`)},verifyPrimaryPassword:async e=>await Me({password:e})}});function ee(){const e=()=>new Promise(t=>chrome.tabs.query({active:!0,lastFocusedWindow:!0},n=>t(n[0])));return{createTab:(t,n)=>{n==null||n.stopPropagation(),chrome.tabs.create(t),window.close()},isAlpha:!1,isBeta:!1,sendTelemetry:async(t,n=!1,a=!1)=>{const s=V(),r=await Ee(s.currentInfo);await ke({name:t,params:r,immediate:n,onlyIfNotSent:a})},beautifyCommand:t=>t==null?void 0:t.replace(/shift/i,"⇧").replace(/command/i,"⌘").replace(/CONTROL/i,"Ctrl").replace(/\+/g,""),addAnchor:(t,n,a)=>{const{t:s}=Oe(),{getLocalizedUrl:r}=V(),u=`<a target="_blank" href='${r(n,a)}'>`;return s(t).replace("[",u).replace("]","</a>")},openGeneralSupportPage:()=>{const{getLocalizedUrl:t}=V();chrome.tabs.create({url:t("/support")})},detectBrowser:()=>{try{const t=navigator.userAgent.toLowerCase();return t.indexOf("edge")>-1||t.indexOf("edg")>-1?"edge":t.indexOf("opr")>-1&&window.opr?"opera":t.indexOf("chrome")>-1?"chrome":t.indexOf("trident")>-1?"firefox":t.indexOf("safari")>-1?"safari":"other"}catch{return"other"}},getCurrentTab:e,getCurrentTabUrl:async()=>{const t=await e();return t==null?void 0:t.url}}}function q(e){return typeof e=="function"?e():Pe(e)}const nt=typeof window<"u"&&typeof document<"u";const at=Object.prototype.toString,st=e=>at.call(e)==="[object Object]",rt=()=>{},ot=e=>e();function it(e,t,n={}){const{eventFilter:a=ot,...s}=n;return z(e,(r=a,u=t,function(...p){return new Promise((P,w)=>{Promise.resolve(r(()=>u.apply(this,p),{fn:u,thisArg:this,args:p})).then(P).catch(w)})}),s);var r,u}function ct(e){var t;const n=q(e);return(t=n==null?void 0:n.$el)!=null?t:n}const G=nt?window:void 0;function lt(...e){let t,n,a,s;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,a,s]=e,t=G):[t,n,a,s]=e,!t)return rt;Array.isArray(n)||(n=[n]),Array.isArray(a)||(a=[a]);const r=[],u=()=>{r.forEach(m=>m()),r.length=0},p=z(()=>[ct(t),q(s)],([m,b])=>{if(u(),!m)return;const g=st(b)?{...b}:b;r.push(...n.flatMap(E=>a.map(y=>((k,f,I,R)=>(k.addEventListener(f,I,R),()=>k.removeEventListener(f,I,R)))(m,E,y,g))))},{immediate:!0,flush:"post"}),P=()=>{p(),u()};var w;return w=P,oe()&&ie(w),P}const j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x="__vueuse_ssr_handlers__",ut=dt();function dt(){return x in j||(j[x]=j[x]||{}),j[x]}const ht={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}};function pt(e,t,n,a={}){var s;const{flush:r="pre",deep:u=!0,listenToStorageChanges:p=!0,writeDefaults:P=!0,mergeDefaults:w=!1,shallow:m,window:b=G,eventFilter:g,onError:E=o=>{}}=a,y=q(t),k=function(o){return o==null?"any":o instanceof Set?"set":o instanceof Map?"map":o instanceof Date?"date":typeof o=="boolean"?"boolean":typeof o=="string"?"string":typeof o=="object"?"object":Number.isNaN(o)?"any":"number"}(y),f=(m?Re:K)(t),I=(s=a.serializer)!=null?s:ht[k];if(!n)try{n=function(o,h){return ut[o]||h}("getDefaultStorageAsync",()=>{var o;return(o=G)==null?void 0:o.localStorage})()}catch(o){E(o)}async function R(o){if(n&&(!o||o.key===e))try{const h=o?o.newValue:await n.getItem(e);if(h==null)f.value=y,P&&y!==null&&await n.setItem(e,await I.write(y));else if(w){const v=await I.read(h);typeof w=="function"?f.value=w(v,y):k!=="object"||Array.isArray(v)?f.value=v:f.value={...y,...v}}else f.value=await I.read(h)}catch(h){E(h)}}return R(),b&&p&&lt(b,"storage",o=>Promise.resolve().then(()=>R(o))),n&&it(f,async()=>{try{f.value==null?await n.removeItem(e):await n.setItem(e,await I.write(f.value))}catch(o){E(o)}},{flush:r,deep:u,eventFilter:g}),f}const ue={name:"DocumentList",props:{}},d=(e,t)=>{const n=new Ue("ui");return pt(`UI_STATE-${e}`,t,n,{serializer:{read:a=>a?JSON.parse(a):null,write:a=>(e==="keysView"&&a.name==="GenericError"&&(a=ue),JSON.stringify(a))}})},V=le("ui",{state:()=>({documentListScrollTop:d("documentListScrollTop",void 0),currentFilter:d("currentFilter","allCategories"),searchText:d("searchText",""),selectedTab:d("selectedTab","keys"),keysView:d("keysView",ue),cardRestorableEntryState:d("cardRestorableEntryState",{}),cardRestorableUiStateCreate:d("cardRestorableUiStateCreate",{}),cardRestorableUiStateEdit:d("cardRestorableUiStateEdit",{}),noteRestorableEntryState:d("noteRestorableEntryState",{}),noteRestorableUiStateCreate:d("noteRestorableUiStateCreate",{}),noteRestorableUiStateEdit:d("noteRestorableUiStateEdit",{}),loginRestorableEntryState:d("loginRestorableEntryState",{}),loginRestorableUiStateCreate:d("loginRestorableUiStateCreate",{}),loginRestorableUiStateEdit:d("loginRestorableUiStateEdit",{}),showPasswordGenerator:d("showPasswordGenerator",!1),show2faModal:d("show2faModal",!1),helpView:d("helpView",{name:"HelpMenu",props:{categoryLocale:void 0}}),locale:"",extension:"",os:"",openCommand:"",optionsView:d("optionsView",{name:"OptionsMenu",props:{categoryLocale:void 0}}),currentInfo:d("currentInfo",_e),settings:Ce,hasSeenHelpImprove:d("hasSeenHelpImprove",!1),hasImportedLogins:d("hasImportedLogins",{platform:"",showBanner:!1}),systemIdleLockTime:d("systemIdleLockTime",60),systemSleepLock:d("systemSleepLock",!0)}),getters:{hasRestorableEntryState:e=>Object.values(e.loginRestorableEntryState).some(t=>t!==void 0),hasNoteRestorableEntryState:e=>Object.values(e.noteRestorableEntryState).some(t=>t!==void 0),hasCardRestorableEntryState:e=>Object.values(e.cardRestorableEntryState).some(t=>t!==void 0),getLocalizedUrl:e=>(t,n)=>{const a=new URL(n??e.currentInfo.website_url);return/^https?/.test(t)?t:(a.pathname=t,decodeURIComponent(a.href))},isOffline:e=>e.currentInfo.networkStatus===void 0||!["has internet","not sure"].includes(e.currentInfo.networkStatus),isVPNConnected:e=>e.currentInfo.state==="connected"},actions:{async setBrowserInfo(){var n;const{beautifyCommand:e}=ee();this.openCommand=await new Promise(a=>{chrome.commands.getAll(s=>{var u;const r=e(((u=s.find(p=>p.name==="_execute_action"))==null?void 0:u.shortcut)||"");a(r)})}),this.os=await new Promise(a=>{chrome.runtime.getPlatformInfo(s=>{a(Le(s.os))})}),this.locale=chrome.i18n.getUILanguage(),this.extension=(n=chrome.runtime.getManifest())==null?void 0:n.version,chrome.idle.setDetectionInterval(60*this.systemIdleLockTime);const t=localStorage.getItem("hasSeenHelpImprove");t&&(this.hasSeenHelpImprove=JSON.parse(t))},setSystemIdleLock(e){let t=e||1;t<1?t=1:t>999&&(t=999),this.systemIdleLockTime=t,chrome.idle.setDetectionInterval(60*t)},setHelpViewTab(e){this.helpView=e},setOptionsViewTab(e){this.optionsView=e},setSelectedTab(e){const{sendTelemetry:t}=ee();this.selectedTab=e,t(`pwm_${e}_tab_tap`)},setImportedLoginPlatform(e){this.hasImportedLogins={platform:e,showBanner:e!==""}},async setSetting(e,t){e==="helpImprove"&&(this.hasSeenHelpImprove=!0,t===!1&&(Ae(),await new Promise(n=>setTimeout(n,100)))),this.settings={...this.settings,[e]:t},chrome.storage.local.set({settings:this.settings})},patchCurrentInfo(e){this.currentInfo={...this.currentInfo,...e}}}}),Rt=e=>{const t=async n=>{Ne(n)?Te("/html/passwordManager.html#/verify-account?mfaStepOnly=true",!0):!Ve(n)||je(n)||xe(n)};addEventListener("unhandledrejection",n=>{n.preventDefault(),t(n.reason),(ae()&&se(W)||H)&&(tt().criticalErrorReason=n.reason||void 0,V().isOffline||(V().keysView={name:"GenericError"}))}),chrome.runtime.onMessage.addListener(n=>{n.action==="unhandledRejectionInBackground"&&t(n.value.reason)})};export{Rt as a,ee as b,tt as c,kt as d,vt as e,Pt as f,Ot as g,Et as h,Xe as i,It as j,ft as k,Fe as l,wt as m,gt as n,St as o,bt as p,V as u,mt as v};
